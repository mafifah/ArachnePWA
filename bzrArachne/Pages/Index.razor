@layout LoginLayout
@page "/"
@using bzrArachne.Service
@using bzrArachne.Models
@inject DataService DataService
@inject NavigationManager NavigationManager
<div class="login-box">
    <div class="login-logo">
        <a><b>Arachne</b></a>
    </div>
    <div class="card">
        <div class="card-body login-card-body">
            <p class="login-box-msg">Sign in to start your session</p>
            <EditForm Model="@user" OnValidSubmit="@GetLogin">
                <div class="input-group mb-3">
                    <input autofocus="" type="text" @bind="user.UserName" class="form-control" placeholder="Username">
                    <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-user"></span>
                        </div>
                    </div>
                </div>
                <div class="row" style="text-align:left; font-size:10px; color:red; margin-left:-5px;">
                    <span class="col-lg-12" style="margin-top:-13px;">@ValidationMesssage</span>
                </div>
                @if (ValidationMesssage != null)
                {
                    <br>
                }
                <div class="input-group mb-3">
                    <input type="password" @bind="user.UserPassword" class="form-control" placeholder="Password">
                    <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-lock"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4">
                        <button type="submit" class="btn btn-primary btn-block">Log In</button>
                    </div>
                    <div class="col-8">
                        <label style="color:red; font-size:12px;">
                            @LoginMesssage
                        </label>
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
</div>
@code {
    private DataUser user = new DataUser();
    public string LoginMesssage { get; set; }
    public string ValidationMesssage { get; set; }
    protected override async Task OnInitializedAsync()
    {
        await DataService.GetLogOut();
    }
    private async Task GetLogin()
    {
        if (String.IsNullOrEmpty(user.UserName))
        {
            ValidationMesssage = "Username tidak boleh kosong";
        }
        else
        {
            var currentUser = await DataService.GetLogin(user);
            if (currentUser.NamaLengkap != null)
            {
                NavigationManager.NavigateTo("/dataBarang");
                //LoginMesssage = $"Berhasil login IdUser: {currentUser.IdUser} UserName:{currentUser.UserName}";
            }
            else
            {
                LoginMesssage = "Username atau password salah";
            }
        }
        //return await Task.FromResult(true);
    }
}